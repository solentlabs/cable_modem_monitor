

<html id="html">
<head>
<meta name="viewport" content="width=1200">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Pragma" content="No-cache" />
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
<meta http-equiv="Expires" content="-1" />
<meta http-equiv="X-UA-Compatible" content="chrome=1"/>
<link rel="shortcut icon"  href="image/mobile_motologin.png"/>
<link rel="stylesheet" type="text/css" href="css/moto.css" />
<title>MB8611</title>
<script type="text/javascript" charset="utf-8" src="js/MotoMenu.js"></script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/initialJS.js"></script>
<script type="text/javascript" charset="utf-8" src="js/AES.js"></script>

<script language="javascript">

var HNAP = new HNAP_XML();
var CurrentAction =10;

function GetMultiXML()
{
	GetMultiXML_1st();
}

function GetMultiXML_1st()
{
	var result_xml = new StringDoc();
	if (result_xml != null)
	{
		result_xml.Set("GetMultipleHNAPs/GetMotoStatusSecAccount");
		result_xml.Set("GetMultipleHNAPs/GetMotoStatusSecXXX");
		HNAP.SetXMLAsync("GetMultipleHNAPs", result_xml, function(xml)	{	GetMultiXML_2nd(xml);	});
	}
	else	
	{	
		if (DebugMode == 1)	
			{	alert("[!!GetXML Error!!] Function: GetMultiXML_1st");	}	
	}
}

var CurrentLogin;
var CurrentNameAdmin;
var CurrentPwAdmin;
var CurrentNameUser;
var CurrentPwUser;

function GetMultiXML_2nd(result_xml)
{
	var GetResult_xml = result_xml.Get("GetMultipleHNAPsResponse/GetMultipleHNAPsResult");
	if (GetResult_xml == "OK")
	{
		CurrentLogin = AES_Decrypt128(result_xml.Get("GetMultipleHNAPsResponse/GetMotoStatusSecAccountResponse/CurrentLogin"));
		CurrentNameAdmin = AES_Decrypt128(result_xml.Get("GetMultipleHNAPsResponse/GetMotoStatusSecAccountResponse/CurrentNameAdmin"));
		CurrentPwAdmin = AES_Decrypt128(result_xml.Get("GetMultipleHNAPsResponse/GetMotoStatusSecAccountResponse/CurrentPwAdmin"));
		CurrentNameUser = AES_Decrypt128(result_xml.Get("GetMultipleHNAPsResponse/GetMotoStatusSecAccountResponse/CurrentNameUser"));
		CurrentPwUser = AES_Decrypt128(result_xml.Get("GetMultipleHNAPsResponse/GetMotoStatusSecAccountResponse/CurrentPwUser"));

		document.getElementById("moto-new-top").style.display = '';
		document.getElementById("moto-new-menu").style.display = '';
		document.getElementById("moto-new-content").style.display = '';
		document.getElementById("moto-reboot-top").style.display = 'none';
		document.getElementById("moto-apply-top").style.display = 'none';
	}
	else
	{
		if (DebugMode == 1)	
			alert("[!!GetXML Error!!] Function: GetMultiXML_2nd");
	}
}

$(document).ready( function()  {
	loadMotoMenu("Status", "Security");
	$("input").change(function () { 
		changeFlag = true;
    });
	$("input").keypress(function () { 
		changeFlag = true;
	});
	GetMultiXML();
});

function loginClick(value){
	if (CurrentAction == 2){ // reset default
		window.location.href="http://192.168.100.1/Login.html";
		CurrentAction=10;
	}else{
		menuClick(value)
	}
}

function SetResult_1st(action) {
	var result_xml = new StringDoc();	
	if (result_xml != null)
	{
		result_xml.Set("SetStatusSecuritySettings/MotoStatusSecurityAction", ""+action);
		if(action == 3)
		{
			result_xml.Set("SetStatusSecuritySettings/MotoUsername", AES_Encrypt128(document.getElementById("MotoUsername").value));
			result_xml.Set("SetStatusSecuritySettings/MotoPassword", AES_Encrypt128(document.getElementById("MotoCurPassword").value));
			result_xml.Set("SetStatusSecuritySettings/MotoNewUsername", AES_Encrypt128(document.getElementById("MotoNewUsername").value));
			result_xml.Set("SetStatusSecuritySettings/MotoNewPassword", AES_Encrypt128(document.getElementById("MotoNewPassword").value));
			result_xml.Set("SetStatusSecuritySettings/MotoRepPassword", AES_Encrypt128(document.getElementById("MotoRepPassword").value));
			document.getElementById("moto-new-top").style.display = 'none';
			document.getElementById("moto-new-menu").style.display = 'none';
			document.getElementById("moto-new-content").style.display = 'none';
			document.getElementById("moto-reboot-top").style.display = 'none';
			document.getElementById("moto-apply-top").style.display = '';
		}
		else
		{
			result_xml.Set("SetStatusSecuritySettings/MotoStatusSecXXX", "XXX");
		}

	 	HNAP.SetXMLAsync("SetStatusSecuritySettings", result_xml, function(xml)   {       SetResult_2nd(xml);     });
	}
	else
	{
		if (DebugMode == 1)
		{
			alert("[!!SetXML Error!!] Function: SetResult_1st");
		}
	}
}

function SetResult_2nd(result_xml)
{
	var SetResult_1st = result_xml.Get("SetStatusSecuritySettingsResponse/SetStatusSecuritySettingsResult");

	if ((SetResult_1st == "UN-AUTH"))
	{
		window.location.reload();
	}
	else if ((SetResult_1st == "OK"))
	{
		var Action = result_xml.Get("SetStatusSecuritySettingsResponse/SetStatusSecuritySettingsAction");
		if(Action == "REBOOT")
		{
			document.getElementById("moto-new-top").style.display = 'none';
			document.getElementById("moto-new-menu").style.display = 'none';
			document.getElementById("moto-new-content").style.display = 'none';
			document.getElementById("moto-apply-top").style.display = 'none';
			document.getElementById("moto-reboot-top").style.display = '';
			document.getElementById("MotoSecMsgTitle").innerHTML = "Rebooting...";
			document.getElementById("MotoSecMsgInfo").innerHTML = "Please wait 3 minutes, then click button to log in again.";
			GetMultiXML();
		}
		else if(Action == "RESTORE")
		{
			document.getElementById("moto-new-top").style.display = 'none';
			document.getElementById("moto-new-menu").style.display = 'none';
			document.getElementById("moto-new-content").style.display = 'none';
			document.getElementById("moto-apply-top").style.display = 'none';
			document.getElementById("moto-reboot-top").style.display = '';
			document.getElementById("MotoSecMsgTitle").innerHTML = "Reloading factory defaults...";
			document.getElementById("MotoSecMsgInfo").innerHTML = "Please wait 3 minutes, then click button to log in again.";
			GetMultiXML();
		}
		else
		{
			alert("Username and/or Password changed successfully.");
			window.location.replace("Login.html");
		}
	}
       else
	{	alert(result_xml.Get("SetStatusSecuritySettingsResponse/SetStatusSecuritySettingsMSG"));
		GetMultiXML();
		document.getElementById("moto-new-top").style.display = '';
		document.getElementById("moto-new-menu").style.display = '';
		document.getElementById("moto-new-content").style.display = '';
		document.getElementById("moto-reboot-top").style.display = 'none';
		document.getElementById("moto-apply-top").style.display = 'none';
	}
}

function CheckUsernameAndPassword(value)
{
    var temp = new RegExp("^[A-Za-z0-9]+$");
	
    if (((value.length!=0) && (!temp.test(value))) || (value.length==0))
    {
        return false;
    }
    return true;
}

function Apply(value)
{
    var name_n_pw_match = 0;
    CurrentAction = value;

    if (value == 3)
    {
        if(!CheckUsernameAndPassword(window.document.MotoSecurity.MotoNewUsername.value) ||
	     !CheckUsernameAndPassword(window.document.MotoSecurity.MotoNewPassword.value))
        {
            alert("You have entered an invalid character. Please click (i) for a list of valid characters.");
	     return;
        }

        if (CurrentLogin == CurrentNameAdmin )
        {
            if ((CurrentNameAdmin == window.document.MotoSecurity.MotoUsername.value)&&
				(CurrentPwAdmin == window.document.MotoSecurity.MotoCurPassword.value))
            {
                //if (CurrentPwAdmin == window.document.MotoSecurity.MotoCurPassword.value)
                {
                    name_n_pw_match = 1;
                }
            }
/*
            else if ((CurrentNameUser == window.document.MotoSecurity.MotoUsername.value)&&
				(CurrentPwUser == window.document.MotoSecurity.MotoCurPassword.value))
            {
                //if (CurrentPwUser == window.document.MotoSecurity.MotoCurPassword.value)
                {
                    name_n_pw_match = 1;
                }
            }
*/
        }
/*
        else if (CurrentNameUser == CurrentLogin)
        {
            if ((CurrentNameUser == window.document.MotoSecurity.MotoUsername.value) && 
    		(CurrentPwUser == window.document.MotoSecurity.MotoCurPassword.value))
            {
                name_n_pw_match = 1;
            }
        }
*/

        if (name_n_pw_match != 1)
        {
            alert("Please enter a valid Username and Password.");
    	     return;
        }
    	
        if(window.document.MotoSecurity.MotoNewPassword.value != window.document.MotoSecurity.MotoRepPassword.value)
        {
            alert("New Password and Repeat New Password do not match. Please re-enter.");
    	     return;
        }

	if(window.document.MotoSecurity.MotoNewPassword.value == CurrentPwAdmin)
	{
		alert("You must choose a new password different from the current password.");
		return;
	}
    }
    SetResult_1st(value);
}

function clearUserName()
{
	window.document.MotoSecurity.MotoNewUsername.value = '';
}

function clearPassword()
{
	window.document.MotoSecurity.MotoNewPassword.value = '';
	window.document.MotoSecurity.MotoRepPassword.value = '';
}

function fillUserName()
{
    if ((CurrentNameAdmin != '' ) && (CurrentNameAdmin == window.document.MotoSecurity.MotoUsername.value))
	window.document.MotoSecurity.MotoNewUsername.value = CurrentNameAdmin;
    else if (CurrentNameUser == window.document.MotoSecurity.MotoUsername.value)
	window.document.MotoSecurity.MotoNewUsername.value = CurrentNameUser;		
}

function fillPassword()
{
    if (CurrentNameAdmin != '' )
    {
        if (CurrentNameAdmin == window.document.MotoSecurity.MotoUsername.value)
        {
            if (CurrentPwAdmin == window.document.MotoSecurity.MotoCurPassword.value)
            {
                window.document.MotoSecurity.MotoNewPassword.value = CurrentPwAdmin;
                window.document.MotoSecurity.MotoRepPassword.value = CurrentPwAdmin;
            }
        }
        else if (CurrentNameUser == window.document.MotoSecurity.MotoUsername.value)
        {
            if (CurrentPwUser == window.document.MotoSecurity.MotoCurPassword.value)
            {
                window.document.MotoSecurity.MotoNewPassword.value = CurrentPwUser;
                window.document.MotoSecurity.MotoRepPassword.value = CurrentPwUser;
            }
        }
    }
    else if (CurrentNameUser == window.document.MotoSecurity.MotoUsername.value)
    {
        if (CurrentPwUser == window.document.MotoSecurity.MotoCurPassword.value)
        {
            window.document.MotoSecurity.MotoNewPassword.value = CurrentPwUser;
            window.document.MotoSecurity.MotoRepPassword.value = CurrentPwUser;
        }
    }
}

function LoginAgain()
{
	window.location.href="Login.html"
}

</script>
</head>

<body onload="">

<div id='moto-new-top' style='display:none'></div>
<div id='moto-new-menu' style='display:none'></div>

<div id='moto-new-content' style='display:none'>
<table cellspacing='0' cellpadding='0' width='100%'>
<tr>
<td class='moto-content-title'>Security</td>
</tr>
<tr>
<td>

<form action=/goform/MotoSecurity method=POST name="MotoSecurity">


<table class="moto-table-title" cellspacing='0' cellpadding='0'>
<tr>
<td>
  <table class='moto-table-content-title' cellspacing='0' cellpadding='0'>
  <tr>
<td class='moto-param-title'>&nbsp;&nbsp;&nbsp;Username & Password</td>
<td class='moto-param-value'><img src="image/mototitle.jpg"/></td>
<td class='moto-param-action'>
<input type='button' class='moto-change-button' value='Save' onClick='Apply(3)'>
</td>
<td class='moto-param-help'></td>
</tr>
  </table>
</td>	
</tr>
<tr>
<td>
<table class="moto-table-content" cellspacing='0' cellpadding='0'>
<tr>
<td style="height:32px">&nbsp;&nbsp;&nbsp;Username</td>
<td class='moto-content-value'><input id="MotoUsername" name="MotoUsername" style="width:120px" maxlength="15"  onfocus="clearUserName()" onblur="fillUserName()" value=></td>
<td></td>
<td class='moto-param-help'><a href='javascript:void(0);'  class="tooltip"><img src="image/motohelp.jpg"/><span>Username:<br>To change the Username, enter the old Username here, and the New Username below. The New Username may be up to 15 alphanumeric characters (a to z, A to Z, and 0 to 9 only). Note you must also enter the old Password. (The interface will auto-fill the New Password and Repeat New Password fields in case you don't want to change them.)<br>
Then click Save.</span></a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="height:32px">&nbsp;&nbsp;&nbsp;Current Password</td>
<td class='moto-content-value'><input type="password" id="MotoCurPassword" name="MotoCurPassword" style="width:120px" maxlength="15"  onfocus="clearPassword()" onblur="fillPassword()" value=***REDACTED***"tooltip"><img src="image/motohelp.jpg"/><span>Current Password:<br>To change the Password, enter the old Password here, and the New Password below in the New Password and Repeat New Password fields. The new Password may be up to 15 alphanumeric characters (a to z, A to Z, and 0 to 9 only). Note you must also enter the old Username to make any changes. (The interface will auto-fill the New Username field in case you don't want to change it.)<br>
Then click Save.</span></a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="height:32px">&nbsp;&nbsp;&nbsp;New Username</td>
<td class='moto-content-value'><input id="MotoNewUsername" name="MotoNewUsername" style="width:120px" maxlength="15" onfocus="clearUserName()" value=''></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="height:32px">&nbsp;&nbsp;&nbsp;New Password</td>
<td class='moto-content-value'><input type="password" id="MotoNewPassword" name="MotoNewPassword" style="width:120px" maxlength="15" onfocus="clearPassword()" value=***REDACTED***"height:32px">&nbsp;&nbsp;&nbsp;Repeat New Password</td>
<td class='moto-content-value'><input type="password" id="MotoRepPassword" name="MotoRepPassword" style="width:120px" maxlength="15" value=***REDACTED***"moto-table-title" cellspacing='0' cellpadding='0'>
<tr>
<td>
  <table class='moto-table-content-title' cellspacing='0' cellpadding='0'>
  <tr>
<td class='moto-param-title'>&nbsp;&nbsp;&nbsp;Reboot/Restore Factory</td>
<td class='moto-param-value'><img src="image/mototitle.jpg"/></td>
<td class='moto-param-action'></td>
<td class='moto-param-help'></td>
</tr>
  </table>
</td>	
</tr>
<tr>
<td>
<table class="moto-table-content" cellspacing='0' cellpadding='0'>
<tr>
<td>&nbsp;</td>
</tr>
<tr>
<td>&nbsp;&nbsp;&nbsp;
<input type='button' class='moto-change-button' value='Reboot' onClick='Apply(1)'>
</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td class='moto-param-help'><a href='javascript:void(0);'  class="tooltip"><img src="image/motohelp.jpg"/><span>Reboot:<br>Click this button if you want to restart your cable modem. This will force re-establishment of all connections.</span></a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
</tr>
<tr>
<td>&nbsp;&nbsp;&nbsp;
<input type='button' class='moto-long-button' value='Restore Factory Defaults' onClick='Apply(2)'>
</td>
<td></td>
<td></td>
<td class='moto-param-help'><a href='javascript:void(0);'  class="tooltip"><img src="image/motohelp.jpg"/><span>Restore Factory Defaults:<br>Click this button to restore factory defaults. Note that you will lose any settings you may have changed.</span></a>&nbsp;&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
</tr>
<tr><td class='moto-wlan-Note' colspan='4'></td></tr>
<tr>
<td class='moto-wlan-Note' colspan='4'>
<input type='hidden' name='MotoSecurityAction' value=''>
<input type='hidden' name='sessionKey' value=''>
</td>

</tr>
</table>
</td>
</tr>
</table>

</form>

</td>  
</tr>  
</table>

</div>

<div id='moto-reboot-top' style='display:none'>
	<table class='table-top' cellspacing='0' cellpadding='0' width='100%'>
		<tr height='78px'>
			<td width='112px' align='center'><img src='image/motolog.jpg' width='106px' height='78px'></td>
			<td width='93px'>&nbsp;</td>
			<td width='82px'>&nbsp;</td>
			<td class='td-top-tail'>&nbsp;</td>
</tr>
		<tr><td class='moto-reboot-title' colspan='4'><span id='MotoSecMsgTitle'></span></td></tr>
		<tr><td class='moto-reboot-msg' colspan='4'><span id='MotoSecMsgInfo'></span></td></tr>
		<tr><td class='moto-reboot-msg' colspan='4' align='center'><input class="moto-long-button" type="button" value="Log in again" onclick="loginClick('Login')"></td></tr>
</table>
</div>

<div id='moto-apply-top'>
</div>

</body>
</html>

