name: Devcontainer CI

on:
  push:
    paths:
      - ".devcontainer/**"
      - "docker-compose.test.yml"
      - "scripts/dev/**"
  pull_request:
    paths:
      - ".devcontainer/**"
      - "docker-compose.test.yml"
      - "scripts/dev/**"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build and test devcontainer
        uses: devcontainers/ci@v0.3
        with:
          runCmd: |
            set -e  # Exit on first error
            echo "=== Devcontainer Smoke Test ==="
            docker info
            docker pull --quiet alpine:latest
            echo "Checking pytest can collect tests..."
            pytest --collect-only -q
            echo "Checking ruff is installed..."
            ruff --version
            echo "=== All checks passed ==="
