{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "üëã Welcome",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "if [ -n \"$REMOTE_CONTAINERS\" ]; then exit 0; elif [ -f .venv/bin/activate ]; then cat scripts/dev/next_steps.txt; else cat scripts/dev/welcome_message.txt; fi"
      ],
      "presentation": {
        "reveal": "silent",
        "panel": "dedicated",
        "clear": true,
        "focus": false,
        "close": true
      },
      "problemMatcher": [],
      "runOptions": {
        "runOn": "folderOpen"
      }
    },
    {
      "label": "üß™ Run All Tests",
      "type": "shell",
      "command": "make test",
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "‚ö° Run Quick Tests",
      "type": "shell",
      "command": "make test-quick",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "‚ú® Lint Code",
      "type": "shell",
      "command": "make lint",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üé® Format Code",
      "type": "shell",
      "command": "make format",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üîÑ Sync Modems",
      "type": "shell",
      "command": "make sync",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "Sync modem.yaml and parser.py from modems/ to custom_components/"
    },
    {
      "label": "üê≥ Check Docker Status",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/dev/check-docker.py",
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Verify Docker is installed and running before executing Docker commands"
    },
    {
      "label": "üöÄ HA: Sync & Run",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/dev/ha-sync-run.py",
      "dependsOn": ["üê≥ Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": [],
      "detail": "Sync modem configs, start HA if needed, restart if running"
    },
    {
      "label": "‚èπÔ∏è HA: Stop",
      "type": "shell",
      "command": "docker compose -f docker-compose.test.yml down && echo '‚úÖ Home Assistant stopped'",
      "dependsOn": ["üê≥ Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üìã HA: View Logs",
      "type": "shell",
      "command": "docker logs -f ha-cable-modem-test",
      "dependsOn": ["üê≥ Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "isBackground": true
    },
    {
      "label": "üóëÔ∏è HA: Clean All Data (Reset)",
      "type": "shell",
      "command": "docker compose -f docker-compose.test.yml down -v && docker run --rm -v \"$(pwd)/test-ha-config:/data\" alpine rm -rf /data/* /data/.[!.]* 2>/dev/null; echo '‚úÖ All Home Assistant data cleaned'",
      "dependsOn": ["üê≥ Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "üîé HA: Check Integration Status",
      "type": "shell",
      "command": "docker exec ha-cable-modem-test bash -c 'echo \"=== Integration Files ===\"; ls -la /config/custom_components/cable_modem_monitor/ 2>&1 | head -10; echo \"\"; echo \"=== Recent Integration Logs ===\"; grep -i cable_modem /config/home-assistant.log 2>&1 | tail -10 || echo \"No logs found (HA may not have started yet)\"'",
      "dependsOn": ["üê≥ Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Check if the integration is loaded and view any errors"
    },
    {
      "label": "üõ†Ô∏è HA: Fix Port Conflicts",
      "type": "shell",
      "command": "bash scripts/dev/ha-cleanup.sh",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Stop any processes using port 8123 and clean up containers"
    },
    {
      "label": "ü©∫ HA: Diagnose Port 8123",
      "type": "shell",
      "command": "echo '=== Checking what is using port 8123 ===' && echo '' && echo 'Method 1: lsof' && sudo lsof -i :8123 2>/dev/null || echo 'No results from lsof' && echo '' && echo 'Method 2: netstat' && sudo netstat -tulpn 2>/dev/null | grep 8123 || echo 'No results from netstat' && echo '' && echo 'Method 3: ss' && sudo ss -tulpn 2>/dev/null | grep 8123 || echo 'No results from ss' && echo '' && echo '=== Docker containers ===' && docker ps -a && echo '' && echo '=== Docker networks ===' && docker network ls",
      "dependsOn": ["üê≥ Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Show detailed info about what's using port 8123"
    },
    {
      "label": "üöÄ Quick Validation (Pre-commit)",
      "type": "shell",
      "command": "python3 scripts/dev/validate.py",
      "group": {
        "kind": "test",
        "isDefault": false
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": false
      },
      "problemMatcher": [],
      "detail": "Lint & format check (auto-installs tools if missing)"
    },
    {
      "label": "üîç Full CI Validation",
      "type": "shell",
      "command": "./scripts/ci-check.sh",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "üîå Check Extension Conflicts",
      "type": "shell",
      "command": "echo 'üîå Checking VSCode extensions...' && echo '' && echo 'Recommended extensions: 10' && echo 'Unwanted extensions: 7' && echo '' && echo 'If you have conflicting extensions installed, please disable them for this workspace.' && echo 'See .vscode/extensions.json for details.'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "üîÑ Fresh Start (Reset VS Code State)",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/dev/fresh_start.py",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Reset VS Code state to test new developer experience (testing only)"
    },
    {
      "label": "üîí Reconfigure Git Email Privacy",
      "type": "shell",
      "command": "./scripts/dev/setup-git-email.sh",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Reconfigure git email (automatically done during initial setup)"
    },
    {
      "label": "üîß Fix Dev Container (Reinstall Dependencies)",
      "type": "shell",
      "command": "bash .devcontainer/post-create.sh",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Re-run post-create setup if tools like ruff/black are missing"
    },
    {
      "label": "‚öôÔ∏è Setup Local Python Environment",
      "type": "shell",
      "command": "./scripts/setup.sh",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Create .venv and install all dependencies"
    },
    {
      "label": "üöÄ Create Release",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/release.py ${input:releaseVersion}",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Automate version bumping, tagging, and release creation"
    },
    {
      "label": "üìπ Capture Modem Traffic",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python3 ${workspaceFolder}/scripts/capture_modem.py --ip ${input:modemIP}",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Launch browser to capture modem traffic"
    }
  ],
  "inputs": [
    {
      "id": "releaseVersion",
      "type": "promptString",
      "description": "Enter the version to release (e.g., 3.5.1)",
      "default": ""
    },
    {
      "id": "modemIP",
      "type": "promptString",
      "description": "Enter modem IP address",
      "default": "192.168.100.1"
    }
  ]
}
