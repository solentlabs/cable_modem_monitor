{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Run All Tests",
      "type": "shell",
      "command": "make test",
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Run Quick Tests",
      "type": "shell",
      "command": "make test-quick",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Lint Code",
      "type": "shell",
      "command": "make lint",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Format Code",
      "type": "shell",
      "command": "make format",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Check Docker Status",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/dev/check-docker.py",
      "windows": {
        "command": "python ${workspaceFolder}/scripts/dev/check-docker.py"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Verify Docker is installed and running before executing Docker commands"
    },
    {
      "label": "HA: Start (Fresh)",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/dev/ha-start.py --fresh",
      "windows": {
        "command": "python ${workspaceFolder}/scripts/dev/ha-start.py --fresh"
      },
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "HA: Start (Keep Data)",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/dev/ha-start.py",
      "windows": {
        "command": "python ${workspaceFolder}/scripts/dev/ha-start.py"
      },
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "HA: Restart (Reload Integration)",
      "type": "shell",
      "command": "docker restart ha-cable-modem-test && echo '‚úÖ Home Assistant restarted - integration code reloaded'",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "HA: Stop",
      "type": "shell",
      "command": "docker compose -f docker-compose.test.yml down && echo '‚úÖ Home Assistant stopped'",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "HA: View Logs",
      "type": "shell",
      "command": "docker logs -f ha-cable-modem-test",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "isBackground": true
    },
    {
      "label": "HA: Clean All Data (Reset)",
      "type": "shell",
      "command": "docker compose -f docker-compose.test.yml down -v && rm -rf test-ha-config/* && echo '‚úÖ All Home Assistant data cleaned'",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": []
    },
    {
      "label": "HA: Check Integration Status",
      "type": "shell",
      "command": "docker exec ha-cable-modem-test bash -c 'echo \"=== Integration Files ===\"; ls -la /config/custom_components/cable_modem_monitor/ 2>&1 | head -10; echo \"\"; echo \"=== Recent Integration Logs ===\"; grep -i cable_modem /config/home-assistant.log 2>&1 | tail -10 || echo \"No logs found (HA may not have started yet)\"'",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Check if the integration is loaded and view any errors"
    },
    {
      "label": "HA: Fix Port Conflicts",
      "type": "shell",
      "command": "bash scripts/dev/ha-cleanup.sh",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Stop any processes using port 8123 and clean up containers"
    },
    {
      "label": "HA: Diagnose Port 8123",
      "type": "shell",
      "command": "echo '=== Checking what is using port 8123 ===' && echo '' && echo 'Method 1: lsof' && sudo lsof -i :8123 2>/dev/null || echo 'No results from lsof' && echo '' && echo 'Method 2: netstat' && sudo netstat -tulpn 2>/dev/null | grep 8123 || echo 'No results from netstat' && echo '' && echo 'Method 3: ss' && sudo ss -tulpn 2>/dev/null | grep 8123 || echo 'No results from ss' && echo '' && echo '=== Docker containers ===' && docker ps -a && echo '' && echo '=== Docker networks ===' && docker network ls",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "Show detailed info about what's using port 8123"
    },
    {
      "label": "Start Docker Dev Environment",
      "type": "shell",
      "command": "make docker-start",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Stop Docker Dev Environment",
      "type": "shell",
      "command": "make docker-stop",
      "dependsOn": ["Check Docker Status"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üöÄ Quick Validation (Pre-commit)",
      "type": "shell",
      "command": "python scripts/dev/validate.py",
      "windows": {
        "command": "python scripts/dev/validate.py"
      },
      "group": {
        "kind": "test",
        "isDefault": false
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": false
      },
      "problemMatcher": [],
      "detail": "Cross-platform lint & format check (auto-installs tools if missing)"
    },
    {
      "label": "üîç Full CI Validation",
      "type": "shell",
      "command": "./scripts/ci-check.sh",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "üîå Check Extension Conflicts",
      "type": "shell",
      "command": "echo 'üîå Checking VSCode extensions...' && echo '' && echo 'Recommended extensions: 10' && echo 'Unwanted extensions: 7' && echo '' && echo 'If you have conflicting extensions installed, please disable them for this workspace.' && echo 'See .vscode/extensions.json for details.'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      },
      "problemMatcher": []
    },
    {
      "label": "üîÑ Fresh Start (Reset VS Code State)",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/dev/fresh_start.py",
      "windows": {
        "command": "python ${workspaceFolder}/scripts/dev/fresh_start.py"
      },
      "options": {
        "cwd": "${workspaceFolder}",
        "shell": {
          "executable": "cmd.exe",
          "args": ["/c"]
        }
      },
      "linux": {
        "options": {
          "shell": {
            "executable": "/bin/bash",
            "args": ["-c"]
          }
        }
      },
      "osx": {
        "options": {
          "shell": {
            "executable": "/bin/bash",
            "args": ["-c"]
          }
        }
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Reset VS Code state to test new developer experience (testing only)"
    },
    {
      "label": "üîí Reconfigure Git Email Privacy",
      "type": "shell",
      "command": "./scripts/dev/setup-git-email.sh",
      "windows": {
        "command": "bash ./scripts/dev/setup-git-email.sh"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Reconfigure git email (automatically done during initial setup)"
    },
    {
      "label": "üîß Fix Dev Container (Reinstall Dependencies)",
      "type": "shell",
      "command": "bash .devcontainer/post-create.sh",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Re-run post-create setup if tools like ruff/black are missing"
    },
    {
      "label": "‚öôÔ∏è Setup Local Python Environment",
      "type": "shell",
      "command": "./scripts/setup.sh",
      "windows": {
        "command": ".\\scripts\\setup.ps1",
        "options": {
          "shell": {
            "executable": "powershell.exe"
          }
        }
      },
      "linux": {
        "options": {
          "shell": {
            "executable": "/bin/bash",
            "args": ["-c"]
          }
        }
      },
      "osx": {
        "options": {
          "shell": {
            "executable": "/bin/bash",
            "args": ["-c"]
          }
        }
      },
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Create .venv and install all dependencies (Option 1: Local Python)"
    },
    {
      "label": "üöÄ Create Release",
      "type": "shell",
      "command": "python3 ${workspaceFolder}/scripts/release.py ${input:releaseVersion}",
      "windows": {
        "command": "python ${workspaceFolder}/scripts/release.py ${input:releaseVersion}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Automate version bumping, tagging, and release creation"
    },
    {
      "label": "üìπ Capture Modem Traffic",
      "type": "shell",
      "command": "${workspaceFolder}/.venv/bin/python ${workspaceFolder}/scripts/capture_modem.py --ip ${input:modemIP}",
      "windows": {
        "command": "${workspaceFolder}\\.venv\\Scripts\\python ${workspaceFolder}\\scripts\\capture_modem.py --ip ${input:modemIP}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true,
        "focus": true
      },
      "problemMatcher": [],
      "detail": "Launch browser to capture modem traffic for parser development (run locally, not in devcontainer)"
    }
  ],
  "inputs": [
    {
      "id": "releaseVersion",
      "type": "promptString",
      "description": "Enter the version to release (e.g., 3.5.1)",
      "default": ""
    },
    {
      "id": "modemIP",
      "type": "promptString",
      "description": "Enter modem IP address",
      "default": "192.168.100.1"
    }
  ]
}
