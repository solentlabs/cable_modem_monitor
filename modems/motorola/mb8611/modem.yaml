# =============================================================================
# Motorola MB8611 Cable Modem
# =============================================================================
# DOCSIS 3.1 modem with HNAP/SOAP authentication
# Uses GetMoto* action names (vs S33's GetCustomer*)
# Verified by @cvonk in [Issue #6](https://github.com/solentlabs/cable_modem_monitor/issues/6) (December 2025)
# Reference: https://github.com/solentlabs/cable_modem_monitor/issues/6

manufacturer: Motorola
model: MB8611
paradigm: hnap

# =============================================================================
# HARDWARE
# =============================================================================
# Source: https://www.motorola.com/us/mb8611
hardware:
  docsis_version: "3.1"
  chipset: Broadcom BCM3390
  release_date: "2020"

# Provenance tracking
sources:
  chipset: "[AfrozAhmad Review](https://afrozahmad.com/blog/motorola-mb8611-cable-modem-review/)"
  hardware: "[Motorola MB8611 page](https://www.motorola.com/us/mb8611)"
  auth_config: "[Issue #6](https://github.com/solentlabs/cable_modem_monitor/issues/6)"
  detection_hints: "[Issue #6](https://github.com/solentlabs/cable_modem_monitor/issues/6)"

# =============================================================================
# NETWORK
# =============================================================================
default_host: "192.168.100.1"

# =============================================================================
# AUTHENTICATION
# =============================================================================
auth:
  types:
    hnap:
      endpoint: "/HNAP1/"
      namespace: "http://purenetworks.com/HNAP1/"
      # MB8611 uses empty string "" for action values (verified from HAR capture)
      empty_action_value: ""
      hmac_algorithm: md5
      formats:
        - json
        - xml
      actions:
        login: "Login"
        downstream: "GetMotoStatusDownstreamChannelInfo"
        upstream: "GetMotoStatusUpstreamChannelInfo"
        restart: "SetStatusSecuritySettings"

  session:
    cookie_name: "uid"
# =============================================================================
# PAGES
# =============================================================================

pages:
  public:
    - "/Login.html"
    - "/MotoHome.html"
  protected:
    - "/MotoStatusConnection.html"
    - "/MotoStatusSecurity.html"
    - "/MotoStatusSoftware.html"
  data:
    downstream_channels: "/HNAP1/"
    upstream_channels: "/HNAP1/"
    system_info: "/HNAP1/"
  hnap_actions:
    downstream_channels: "GetMotoStatusDownstreamChannelInfo"
    upstream_channels: "GetMotoStatusUpstreamChannelInfo"
    startup_sequence: "GetMotoStatusStartupSequence"
    connection_info: "GetMotoStatusConnectionInfo"
    software_info: "GetMotoStatusSoftware"
    lag_status: "GetMotoLagStatus"

# =============================================================================
# PARSER
# =============================================================================
parser:
  class: MotorolaMB8611HnapParser
  module: custom_components.cable_modem_monitor.modems.motorola.mb8611.parser
  format:
    type: json
    # HNAP uses caret (^) and pipe-plus-pipe (|+|) delimiters
    delimiters:
      field: "^"
      record: "|+|"

# =============================================================================
# DETECTION
# =============================================================================
detection:
  pre_auth:
    - "HNAP"
    - "purenetworks.com/HNAP1"
    - "SOAPAction"
    - "/Login.html"
  post_auth:
    - "MB8611"
    - "MB 8611"
    - "2251-MB8611"
    - "MB8612"
    - "Motorola"
    - "HNAP"
    - "purenetworks.com/HNAP1"
  page_hint: "/HNAP1/"
  model_aliases:
    - "MB8612"
# =============================================================================
# CAPABILITIES
# =============================================================================
capabilities:
  - scqam_downstream
  - scqam_upstream
  - ofdm_downstream
  - ofdma_upstream
  - system_uptime
  - hardware_version
  - software_version

# =============================================================================
# ACTIONS
# =============================================================================
actions:
  restart:
    type: hnap
    action_name: "SetStatusSecuritySettings"
    params:
      MotoStatusSecurityAction: "1"
      MotoStatusSecXXX: "XXX"
    response_key: "SetStatusSecuritySettingsResponse"
    result_key: "SetStatusSecuritySettingsResult"
    success_value: "OK"

# =============================================================================
# BEHAVIORS
# =============================================================================
behaviors:
  restart:
    window_seconds: 300
    zero_power_reported: true

# =============================================================================
# METADATA
# =============================================================================
# =============================================================================
# STATUS
# =============================================================================
status_info:
  status: verified
  verification_source: "https://github.com/solentlabs/cable_modem_monitor/issues/6"

# =============================================================================
# METADATA
# =============================================================================
fixtures:
  path: modems/motorola/mb8611/fixtures
  source: diagnostics
  firmware_tested: "8611-19.2.18"
  last_validated: "2026-01-05"

attribution:
  contributors:
    - github: dlindnegm
      contribution: "Original HTML page captures (Issue #4, October 2025)"
    - github: cvonk
      contribution: "HAR captures, debug logs, iterative testing (Issue #6, November 2025)"
    - github: BowlesCR
      contribution: "HNAP authentication implementation (Issue #40)"
    - github: kwschulz
      contribution: "Maintainer"

isps:
  - Comcast
  - Xfinity
  - Cox
  - Spectrum

notes: |
  HNAP Channel Data Format: Caret-delimited fields, pipe-separated records
  Format: ID^Status^Mod^ChID^Freq^Power^SNR^Corr^Uncorr^|+|...

  Default credentials: admin / motorola

  Parser built from:
  - User captures in RAW_DATA/MB8611/ (diagnostics JSON files)
  - MotoStatusConnection.html JavaScript analysis revealing HNAP actions
  - External reference implementations (see references)

references:
  tatsh_mb8611: "https://github.com/Tatsh/mb8611"
  johlym_metrics: "https://github.com/johlym/mb8611-metrics"
  xninjakittyx_mb8600: "https://github.com/xNinjaKittyx/mb8600"
  bowlescr_login: "https://github.com/BowlesCR/MB8600_Login"
  issue_fixtures: "https://github.com/solentlabs/cable_modem_monitor/issues/4"
  issue_verification: "https://github.com/solentlabs/cable_modem_monitor/issues/6"
  gpl_source: "https://help.motorolanetwork.com/kb/general/gpl-code-center"
  source_code: "https://help.motorolanetwork.com/kb/general/gpl-code-center"
