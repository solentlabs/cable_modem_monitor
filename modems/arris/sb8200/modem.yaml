# =============================================================================
# ARRIS SB8200 Cable Modem Configuration
# =============================================================================
# DOCSIS 3.1 modem with 32x8 channels plus OFDM/OFDMA
#
# Known firmware variants:
# - Spectrum LA: HTTP, no auth required
# - Other ISPs: HTTPS with self-signed cert, URL-based auth
#
# Default credentials: admin / last 8 chars of serial number

manufacturer: ARRIS
model: SB8200
paradigm: html

# =============================================================================
# HARDWARE
# =============================================================================
hardware:
  docsis_version: "3.1"
  chipset: Broadcom BCM3390
  release_date: "2016"

# Provenance tracking
sources:
  chipset: "[DeviWiki](https://deviwiki.com/wiki/Arris_SB8200)"
  hardware: "[ARRIS SB8200 page](https://www.arris.com/surfboard/products/cable-modems/sb8200/)"
  auth_config: "[Issue #42](https://github.com/solentlabs/cable_modem_monitor/issues/42)"
  detection_hints: "[Issue #42](https://github.com/solentlabs/cable_modem_monitor/issues/42)"

# =============================================================================
# NETWORK
# =============================================================================
# Protocol varies by firmware - can be HTTP (no auth) or HTTPS (with auth)
protocol: http
default_host: "192.168.100.1"
default_port: 80

# =============================================================================
# AUTHENTICATION
# =============================================================================
# SB8200 has two distinct firmware variants with different auth:
# - Spectrum LA firmware: No auth required (HTTP, public pages)
# - Other ISP firmware: URL token auth (HTTPS, requires credentials)
#
# User selects their auth type during config flow.
#
# URL token auth flow (when required):
# 1. Credentials are base64-encoded as "username:password"
# 2. Login URL: /cmconnectionstatus.html?login_<base64_token>
# 3. Authorization header: Basic <base64_token>
# 4. Response sets session cookie (sessionId)
# 5. Subsequent requests use: ?ct_<session_token>

auth:
  # SB8200 has two distinct firmware variants with different auth:
  # - Spectrum LA firmware: No auth required (HTTP, public pages)
  # - Other ISP firmware: URL token auth (HTTPS, requires credentials)
  #
  # User selects their auth type during config flow.
  types:
    none: null # Spectrum LA firmware - no auth needed
    url_token: # Other ISP firmware - URL token auth
      login_page: "/cmconnectionstatus.html"
      login_prefix: "login_"
      token_prefix: "ct_"
      session_cookie: "sessionId"
      success_indicator: "Downstream Bonded Channels"
# =============================================================================
# PAGES
# =============================================================================

pages:
  public: [] # SB8200 has no public pages - all require auth in HTTPS variant
  protected:
    - "/cmconnectionstatus.html"
    - "/cmswinfo.html"
    - "/cmeventlog.html"
    - "/cmaddress.html"
    - "/cmconfiguration.html"
    - "/lagcfg.html"
  data:
    downstream_channels: "/cmconnectionstatus.html"
    upstream_channels: "/cmconnectionstatus.html"
    system_info: "/cmswinfo.html"

# =============================================================================
# PARSER
# =============================================================================
parser:
  class: ArrisSB8200Parser
  module: custom_components.cable_modem_monitor.modems.arris.sb8200.parser
  format:
    type: html
    table_layout: standard

# =============================================================================
# DETECTION
# =============================================================================
detection:
  pre_auth:
    - "SB8200"
    - "ARRIS"
    - "Downstream Bonded Channels"
    - "cmconnectionstatus.html"
  post_auth:
    - "SB8200"
    - "ARRIS SB8200"
    - "Downstream Bonded Channels"
  page_hint: "/cmswinfo.html"
# =============================================================================
# CAPABILITIES
# =============================================================================
capabilities:
  - scqam_downstream
  - scqam_upstream
  - ofdm_downstream
  - ofdma_upstream
  - system_uptime
  - software_version
  - hardware_version

# =============================================================================
# METADATA
# =============================================================================
# =============================================================================
# STATUS
# =============================================================================
status_info:
  status: verified
  verification_source: "https://github.com/solentlabs/cable_modem_monitor/issues/42"

# =============================================================================
# METADATA
# =============================================================================
fixtures:
  path: modems/arris/sb8200/fixtures
  source: diagnostics
  firmware_tested: "AB01.01.009.36.02_022720_183.0A.NSH"
  last_validated: "2026-01-05"

attribution:
  contributors:
    - github: undotcom
      contribution: "Initial SB8200 support and fixture capture (HTTP variant, Issue #42)"
    - github: ctravis8892
      contribution: "HTTPS authentication variant (Issue #81)"

isps:
  - Comcast
  - Xfinity
  - Cox
  - Spectrum

notes: |
  Reboot Capability: DISABLED (server-side blocked by ISP firmware)

  In 2015-2016, ARRIS SURFboard modems (particularly SB6141) had a critical
  security vulnerability: the admin interface required NO authentication,
  allowing anyone on the local network unrestricted access. The interface
  was vulnerable to CSRF attacks - attackers could embed malicious image tags
  like <img src="http://192.168.100.1/reset.htm"> to remotely trigger reboots.

  With 135 million affected modems worldwide, rather than implementing proper
  auth controls, ARRIS disabled reboot/reset functionality in firmware updates.
  This persists in modern models like the SB8200.

  Technical: The SB8200 firmware includes a reboot button in cmconfiguration.html
  with a disabled attribute. Direct POST requests to /cmconfiguration.html with
  Rebooting=1 are rejected server-side by ISP firmware (tested on Spectrum).

  Parser handles both firmware variants automatically:
  - No credentials: Assumes HTTP variant, fetches without auth
  - With credentials: Uses URL Token Session auth
  - HTTPS auth fails (non-401): Falls back to unauthenticated fetch

references:
  security_vulnerability: "https://thehackernews.com/2016/04/hack-modem-internet.html"
  community_letter: "https://community.surfboard.com/sb8200-59/open-letter-to-arris-why-do-you-disable-basic-functionality-e-g-software-reboot-on-the-sb8200-5829"
  issue_http: "https://github.com/solentlabs/cable_modem_monitor/issues/42"
  issue_https: "https://github.com/solentlabs/cable_modem_monitor/issues/81"
