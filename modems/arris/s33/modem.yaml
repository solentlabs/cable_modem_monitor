# =============================================================================
# Arris/CommScope S33 Cable Modem
# =============================================================================
# DOCSIS 3.1 modem with HNAP/SOAP authentication
# Uses GetCustomer* action names (vs MB8611's GetMoto*)
# Reference: https://github.com/solentlabs/cable_modem_monitor/issues/32

manufacturer: Arris/CommScope
model: S33
paradigm: hnap

# =============================================================================
# HARDWARE
# =============================================================================
# Source: https://www.surfboard.com/products/cable-modems/s33/
hardware:
  docsis_version: "3.1"
  chipset: Broadcom BCM3390
  release_date: "2020"

# Provenance tracking
sources:
  chipset: "[ModemGuides](https://www.modemguides.com/blogs/modemguides-blog/arris-s33-vs-sb8200-comparison)"
  hardware: "[SURFboard S33 page](https://www.surfboard.com/products/cable-modems/s33/)"
  auth_config: "HAR analysis by maintainer"
  detection_hints: "[Issue #87](https://github.com/solentlabs/cable_modem_monitor/issues/87)"

# =============================================================================
# NETWORK
# =============================================================================
protocol: http
default_host: "192.168.100.1"
default_port: 80

# =============================================================================
# AUTHENTICATION
# =============================================================================
auth:
  strategy: hnap

  hnap:
    endpoint: "/HNAP1/"
    namespace: "http://purenetworks.com/HNAP1/"
    # S33-specific: uses empty string "" for action values (not {} like MB8611)
    empty_action_value: ""
    formats:
      - json
    actions:
      login: "Login"
      downstream: "GetCustomerStatusDownstreamChannelInfo"
      upstream: "GetCustomerStatusUpstreamChannelInfo"
      restart: "SetArrisConfigurationInfo"

  session:
    cookie_name: "uid"
# =============================================================================
# PAGES
# =============================================================================

pages:
  public:
    - "/Login.html"
  protected:
    - "/cmconnectionstatus.html"
    - "/Cmconnectionstatus.html"
  data:
    downstream_channels: "/HNAP1/"
    upstream_channels: "/HNAP1/"
    system_info: "/HNAP1/"
  hnap_actions:
    downstream_channels: "GetCustomerStatusDownstreamChannelInfo"
    upstream_channels: "GetCustomerStatusUpstreamChannelInfo"
    startup_sequence: "GetCustomerStatusStartupSequence"
    connection_info: "GetCustomerStatusConnectionInfo"
    device_status: "GetArrisDeviceStatus"

# =============================================================================
# PARSER
# =============================================================================
parser:
  class: ArrisS33HnapParser
  module: custom_components.cable_modem_monitor.modems.arris.s33.parser
  format:
    type: json
    # HNAP uses caret (^) and pipe-plus-pipe (|+|) delimiters
    delimiters:
      field: "^"
      record: "|+|"

# =============================================================================
# DETECTION
# =============================================================================
detection:
  pre_auth:
    - "HNAP"
    - "purenetworks.com/HNAP1"
    - "SURFboard"
    - "/Login.html"
  post_auth:
    - "S33"
    - "ARRIS S33"
    - "CommScope S33"
    - "ARRIS"
    - "CommScope"
    - "HNAP"
    - "purenetworks.com/HNAP1"
    - "SURFboard"
  page_hint: "/HNAP1/"
  model_aliases:
    - "CommScope S33"
    - "ARRIS S33"
# =============================================================================
# CAPABILITIES
# =============================================================================
capabilities:
  - scqam_downstream
  - scqam_upstream
  - ofdm_downstream
  - ofdma_upstream
  - software_version
  - restart

# =============================================================================
# BEHAVIORS
# =============================================================================
behaviors:
  restart_window_seconds: 300
  zero_power_during_restart: true

# =============================================================================
# STATUS
# =============================================================================
status_info:
  status: verified
  verification_source: "https://github.com/solentlabs/cable_modem_monitor/issues/87"

# =============================================================================
# METADATA
# =============================================================================
fixtures:
  path: modems/arris/s33/fixtures
  source: diagnostics
  firmware_tested: null
  last_validated: "2026-01-05"

attribution:
  contributors:
    - github: kwschulz
      contribution: "Maintainer - HNAP implementation from HAR analysis"
